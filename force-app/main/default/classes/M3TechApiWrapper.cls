/**
	Author	: Cw Tham (cw.tham@hyundai.com.my)
	Date	: 2018-10-04

	Name	: M3TechApiWrapper
	Function:
		M3 Tech API wrapper class for SMS gateway.

	Changelog:
	2018-10-04	Creation of wrapper class.


	String ret = M3TechApiWrapper.deliverMessage('Beng', 'hsdmso', 'This is a test message from beng in Singapore', '+60103780178');
	System.debug(ret);

	+60193876899

*/
public class M3TechApiWrapper {
	public static String USERNAME = API_Setup__c.getInstance('M3 Tech Username').Value__c;
	public static String PASSWORD = API_Setup__c.getInstance('M3 Tech Password').Value__c;
	public static String ENDPOINT = API_Setup__c.getInstance('M3 Tech URL').Value__c;
	public static String USERNAME2 = API_Setup__c.getInstance('M3 Tech 2 Username').Value__c;
	public static String PASSWORD2 = API_Setup__c.getInstance('M3 Tech 2 Password').Value__c;
	public static String ENDPOINT2 = API_Setup__c.getInstance('M3 Tech 2 URL').Value__c;
	public static final integer TIMED_OUT_SHORT		= 5000;		// 5 seconds
	public static final integer TIMED_OUT_NORMAL	= 90000;	// 90 seconds
	public static final integer TIMED_OUT_LONG		= 120000;	// 120 seconds

	/*
		msgId : uniquely identifiable text
		serviceId : ‘hsdmso’ here indicates HSDM Sales Operation. As this SMS service was used by that specific department.
		The report generated by vendor would ease the Finance department in segregating the cost of service usage.
	*/


	public static string deliverMessage(string msgId, string serviceId, string msgContent, string mobileNo) {
		M3TechApi.IMPServiceSoap svc = new M3TechApi.IMPServiceSoap();
		svc.endpoint_x = ENDPOINT;
		svc.timeout_x = TIMED_OUT_LONG;
		string szTimeStamp = Datetime.now().format('yyyyMMddHHmmss');
		string ret;
		/** Start calling SMS gateway. */
		system.debug(string.format('deliverMessage({0}, {1}, {2}, {3})'
						, new string[] { msgId, serviceId, msgContent, mobileNo }));
		ret = svc.deliverMessage(USERNAME, PASSWORD, msgId, szTimeStamp, serviceId, msgContent, mobileNo, 'push', '000', '01');
		system.debug('deliverMessage ret: ' + ret);
		return ret;
	}

	public static string deliverMessage2(string msgId, string serviceId, string msgContent, string mobileNo) {
		M3TechApi2.IMPServiceSoap svc = new M3TechApi2.IMPServiceSoap();
		svc.endpoint_x = ENDPOINT2;
		svc.timeout_x = TIMED_OUT_LONG;
		string szTimeStamp = Datetime.now().format('yyyyMMddHHmmss');
		string ret;
		/** Start calling SMS gateway. */
		system.debug(string.format('deliverMessage2({0}, {1}, {2}, {3})'
						, new string[] { msgId, serviceId, msgContent, mobileNo }));
		ret = svc.deliverMessage(USERNAME2, PASSWORD2, msgId, szTimeStamp, serviceId, msgContent, mobileNo, '66600', '000', '03');
		system.debug('deliverMessage2 ret: ' + ret);
		return ret;
	}
}