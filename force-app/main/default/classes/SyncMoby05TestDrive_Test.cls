@isTest
public class SyncMoby05TestDrive_Test {

	@TestSetup
	static void makeData(){
		SyncMobyApiBase_Test.makeData();

		// SyncMoby01User_Test.testPull();
		SyncMoby01User.MobyUserRes resUser = SyncMoby01User_Test.createObj();
		SyncMoby01User jobUser = new SyncMoby01User();
		jobUser.upsertUser(resUser);

		SyncMoby02Contact.MobyContactRes resCont = SyncMoby02Contact_Test.createObj();
		SyncMoby02Contact jobCont = new SyncMoby02Contact();
		jobCont.upsertContact(resCont);

		SyncMoby04Opportunity.MobyOpportunityRes resOppo = SyncMoby04Opportunity_Test.createObj();
		SyncMoby04Opportunity jobOppo = new SyncMoby04Opportunity();
		jobOppo.upsertOppo(resOppo);

		TestFactory.genVehicle(3, true);
		
		// remove Showroom__c records
		delete [SELECT Id FROM Showroom__c];
	}
	
	@isTest
	public static SyncMoby05TestDrive.MobyTestDriveRes createObj() {
		Vehicle__c[] vehs = [SELECT Id, Name FROM Vehicle__c];
		
		SyncMoby05TestDrive.MobyTestDriveRes response = new SyncMoby05TestDrive.MobyTestDriveRes();
		response.testDrives = new SyncMoby05TestDrive.MobyTestDrive[]{};

		SyncMoby05TestDrive.MobyTestDrive tdrv;
		SyncMoby05TestDrive.MobyTestDriveDetail tdde;

		/** TestDrive 1 */
		tdrv = new SyncMoby05TestDrive.MobyTestDrive();
		tdrv.id = 1074;
		tdrv.userId = 417;
		tdrv.contactId = 1362;
		tdrv.opportunityId = 725;
		tdrv.companyId = 1;
		tdrv.companyCode = 'SDAB';
		tdrv.companyName = 'SD Auto Bavaria';
		tdrv.branchId = 3;
		tdrv.branchCode = 'ABAD';
		tdrv.branchName = 'SDAB Ara Damansara';
		tdrv.makeId = 4;
		tdrv.makeCode = 'Motorrad';
		tdrv.makeName = 'Motorrad';
		tdrv.taskId = null;
		tdrv.icNo = '770401036161';
		tdrv.icDocId = null;
		tdrv.licenseNo = '21123743';
		tdrv.icDocFrId = 2568;
		tdrv.icDocRrId = 2569;
		tdrv.licenseExpiryDate = Datetime.valueOf('2019-04-01 00:00:00');
		tdrv.licenseDocFrId = 2570;
		tdrv.licenseDocRrId = 2572;
		tdrv.indemnityDocId = 2460;
		tdrv.thankYouDocId = null;
		tdrv.plannedDateStart = Datetime.valueOf('2019-03-03 14:22:06.11+08:00');
		tdrv.plannedDateEnd = null;
		tdrv.remarks = null;
		tdrv.sourceUserid = null;
		tdrv.transferUserId = null;
		tdrv.insertDate = Datetime.valueOf('2019-03-03 14:22:06.11+08:00');
		tdrv.insertUserId = 417;
		tdrv.updateDate = Datetime.valueOf('2019-03-03 15:23:49.427+08:00');
		tdrv.updateUserId = 417;
		tdrv.details = null;
		// tdrv.details = new SyncMoby05TestDrive.MobyTestDriveDetail[]{};
		// tdde = new SyncMoby05TestDrive.MobyTestDriveDetail();
		// tdrv.details.add(tdde);
		response.testDrives.add(tdrv);

		/** TestDrive 2 */
		tdrv = new SyncMoby05TestDrive.MobyTestDrive();
		tdrv.id = 17468;
		tdrv.userId = 417;
		tdrv.contactId = 1363;
		tdrv.opportunityId = 737;
		tdrv.companyId = 1;
		tdrv.companyCode = 'SDAB';
		tdrv.companyName = 'SD Auto Bavaria';
		tdrv.branchId = 3;
		tdrv.branchCode = 'ABAD';
		tdrv.branchName = 'SDAB Ara Damansara';
		tdrv.makeId = 4;
		tdrv.makeCode = 'Motorrad';
		tdrv.makeName = 'Motorrad';
		tdrv.taskId = null;
		tdrv.icNo = '790525075611';
		tdrv.icDocId = null;
		tdrv.licenseNo = 'B';
		tdrv.icDocFrId = 64031;
		tdrv.icDocRrId = 64032;
		tdrv.licenseExpiryDate = Datetime.valueOf('2021-05-25 00:00:00');
		tdrv.licenseDocFrId = 64033;
		tdrv.licenseDocRrId = 64034;
		tdrv.indemnityDocId = 22489;
		tdrv.thankYouDocId = 22518;
		tdrv.plannedDateStart = Datetime.valueOf('2019-12-18 13:43:24.357+08:00');
		tdrv.plannedDateEnd = null;
		tdrv.remarks = null;
		tdrv.sourceUserid = null;
		tdrv.transferUserId = null;
		tdrv.insertDate = Datetime.valueOf('2019-12-18 13:43:24.357+08:00');
		tdrv.insertUserId = 417;
		tdrv.updateDate = Datetime.valueOf('2019-12-18 14:46:40.197+08:00');
		tdrv.updateUserId = 417;
		tdrv.details = new SyncMoby05TestDrive.MobyTestDriveDetail[]{};

		tdde = new SyncMoby05TestDrive.MobyTestDriveDetail();
		tdde.id = 15344;
		tdde.userId = 417;
		tdde.contactId = 1364;
		tdde.testDriveId = 17468;
		tdde.companyId = 1;
		tdde.branchId = 6;
		tdde.makeId = 4;
		tdde.statusId = 15;
		tdde.statusCode = 'NEW';
		tdde.statusName = 'New';
		tdde.stockId = vehs[0].Name; // 'WB10J5404KR933691';
		tdde.categoryId = 15;
		tdde.categoryCode = 'DEMO';
		tdde.categoryName = 'Demo Car';
		tdde.colour = null;
		tdde.conditionId = 13;
		tdde.conditionCode = 'USED';
		tdde.conditionName = 'Used Car';
		tdde.modelId = 160;
		tdde.modelCode = 'R 1250 GS ADVENTURE';
		tdde.modelName = 'Adventure R 1250 GS ADVENTURE';
		tdde.modelAssemblyCode = null;
		tdde.modelBodyType = null;
		tdde.modelCylinder = null;
		tdde.modelDisplacement = '1,254';
		tdde.modelFuelType = 'Petrol';
		tdde.modelMakeId = 4;
		tdde.modelYear = 2019;
		tdde.plateNo = 'PPB6698';
		tdde.registrationDate = null;
		tdde.registrationNo = 'PPB6698';
		tdde.sellingPrice = null;
		tdde.shortChassis = 'R933691';
		tdde.stockStatusId = 39;
		tdde.stockStatusCode = 'AVAILABLE';
		tdde.stockStatusName = 'AVAILABLE';
		tdde.stockStatusNumber = null;
		tdde.stockSubMakeId = null;
		tdde.stockSubMakeCode = null;
		tdde.stockSubMakeName = null;
		tdde.variantId = 502;
		tdde.variantCode = '0J54';
		tdde.variantName = 'Adventure R 1250 GS Adv (0J54)';
		tdde.variantAssemblyCode = null;
		tdde.variantBodyType = null;
		tdde.variantCylinder = 'Four Stroke Flat Twin Engine';
		tdde.variantDisplacement = '1,254';
		tdde.extVariantUid = '4a103408-8d02-e911-a991-000d3a821ec4';
		tdde.variantFuelType = 'Petrol';
		tdde.variantModelId = 51;
		tdde.variantMakeId = 4;
		tdde.variantSystem = null;
		tdde.tradePlateNo = 'PPB6698';
		tdde.actualDateStart = Datetime.valueOf('2019-12-18 13:58:10.293+08:00');
		tdde.actualDateEnd = null;
		tdde.mileageStart = 5238;
		tdde.mileageEnd = 5259;
		tdde.mileageStartDocId = null;
		tdde.mileageEndDocId = null;
		tdde.odoStartDocId = null;
		tdde.odoEndDocId = null;
		tdde.guardMileageStart = null;
		tdde.guardMileageEnd = null;
		tdde.extTestDriveUid = null;
		tdde.insertDate = Datetime.valueOf('2019-12-18 13:58:10.293+08:00');
		tdde.insertUserId = 417;
		tdde.updateDate = Datetime.valueOf('2019-12-18 13:58:10.293+08:00');
		tdde.updateUserId = 417;
		tdrv.details.add(tdde);
		response.testDrives.add(tdrv);

		/** TestDrive 3 */
		tdrv = new SyncMoby05TestDrive.MobyTestDrive();
		tdrv.id = 22760;
		tdrv.userId = 1376;
		tdrv.contactId = 88301;
		tdrv.opportunityId = 757;
		tdrv.companyId = 1;
		tdrv.companyCode = 'SDAB';
		tdrv.companyName = 'SD Auto Bavaria';
		tdrv.branchId = 4;
		tdrv.branchCode = 'ABSB';
		tdrv.branchName = 'SDAB Sg. Besi';
		tdrv.makeId = 1;
		tdrv.makeCode = 'BMW';
		tdrv.makeName = 'BMW';
		tdrv.taskId = null;
		tdrv.icNo = '123456789090';
		tdrv.icDocId = null;
		tdrv.licenseNo = '7890';
		tdrv.icDocFrId = 86565;
		tdrv.icDocRrId = 86568;
		tdrv.licenseExpiryDate = Datetime.valueOf('2022-08-05 00:00:00');
		tdrv.licenseDocFrId = 86566;
		tdrv.licenseDocRrId = 86567;
		tdrv.indemnityDocId = 86406;
		tdrv.thankYouDocId = 86426;
		tdrv.plannedDateStart = Datetime.valueOf('2020-08-05 16:07:50.89+08:00');
		tdrv.plannedDateEnd = null;
		tdrv.remarks = null;
		tdrv.sourceUserid = null;
		tdrv.transferUserId = null;
		tdrv.insertDate = Datetime.valueOf('2020-08-05 16:07:50.89+08:00');
		tdrv.insertUserId = 24;
		tdrv.updateDate = Datetime.valueOf('2020-08-05 16:18:37.52+08:00');
		tdrv.updateUserId = 67;
		tdrv.details = new SyncMoby05TestDrive.MobyTestDriveDetail[]{};

		tdde = new SyncMoby05TestDrive.MobyTestDriveDetail();
		tdde.id = 20088;
		tdde.userId = 1376;
		tdde.contactId = 88301;
		tdde.testDriveId = 22760;
		tdde.companyId = 1;
		tdde.branchId = 3;
		tdde.makeId = 1;
		tdde.statusId = 15;
		tdde.statusCode = 'NEW';
		tdde.statusName = 'New';
		tdde.stockId = vehs[1].Name; // 'PM1UJ38020LG63332';
		tdde.categoryId = 15;
		tdde.categoryCode = 'DEMO';
		tdde.categoryName = 'Demo Car';
		tdde.colour = null;
		tdde.conditionId = 13;
		tdde.conditionCode = 'USED';
		tdde.conditionName = 'Used Car';
		tdde.modelId = 169;
		tdde.modelCode = 'G02';
		tdde.modelName = 'BMW X4 G02';
		tdde.modelAssemblyCode = 'CBU';
		tdde.modelBodyType = null;
		tdde.modelCylinder = null;
		tdde.modelDisplacement = null;
		tdde.modelFuelType = null;
		tdde.modelMakeId = 1;
		tdde.modelYear = 2019;
		tdde.plateNo = 'VDH8089';
		tdde.registrationDate = null;
		tdde.registrationNo = 'VDH8089';
		tdde.sellingPrice = null;
		tdde.shortChassis = 'LG63332';
		tdde.stockStatusId = 39;
		tdde.stockStatusCode = 'AVAILABLE';
		tdde.stockStatusName = 'AVAILABLE';
		tdde.stockStatusNumber = null;
		tdde.stockSubMakeId = null;
		tdde.stockSubMakeCode = null;
		tdde.stockSubMakeName = null;
		tdde.variantId = 497;
		tdde.variantCode = 'UJ38A7';
		tdde.variantName = 'BMW X4 xDrive30i M Sport (G02)';
		tdde.variantAssemblyCode = 'CBU';
		tdde.variantBodyType = 'Sport Activity Coupe';
		tdde.variantCylinder = 'In-Line 4';
		tdde.variantDisplacement = '1,998';
		tdde.extVariantUid = 'c286247f-e67d-e911-a995-000d3a828826';
		tdde.variantFuelType = 'Petrol';
		tdde.variantModelId = 169;
		tdde.variantMakeId = 1;
		tdde.variantSystem = 'Manual';
		tdde.tradePlateNo = 'VDH8089';
		tdde.actualDateStart = Datetime.valueOf('2020-08-05 16:09:06.11+08:00');
		tdde.actualDateEnd = null;
		tdde.mileageStart = 25;
		tdde.mileageEnd = null;
		tdde.mileageStartDocId = null;
		tdde.mileageEndDocId = null;
		tdde.odoStartDocId = null;
		tdde.odoEndDocId = null;
		tdde.guardMileageStart = null;
		tdde.guardMileageEnd = null;
		tdde.extTestDriveUid = null;
		tdde.insertDate = Datetime.valueOf('2020-08-05 16:09:06.11+08:00');
		tdde.insertUserId = 24;
		tdde.updateDate = Datetime.valueOf('2020-08-05 16:09:06.11+08:00');
		tdde.updateUserId = 67;
		tdrv.details.add(tdde);

		tdde = new SyncMoby05TestDrive.MobyTestDriveDetail();
		tdde.id = 20089;
		tdde.userId = 1376;
		tdde.contactId = 88301;
		tdde.testDriveId = 22760;
		tdde.companyId = 1;
		tdde.branchId = 3;
		tdde.makeId = 1;
		tdde.statusId = 15;
		tdde.statusCode = 'NEW';
		tdde.statusName = 'New';
		tdde.stockId = vehs[2].Name; // 'PM1UJ38020LG63332';
		tdde.categoryId = 15;
		tdde.categoryCode = 'DEMO';
		tdde.categoryName = 'Demo Car';
		tdde.colour = null;
		tdde.conditionId = 13;
		tdde.conditionCode = 'USED';
		tdde.conditionName = 'Used Car';
		tdde.modelId = 169;
		tdde.modelCode = 'G02';
		tdde.modelName = 'BMW X4 G02';
		tdde.modelAssemblyCode = 'CBU';
		tdde.modelBodyType = null;
		tdde.modelCylinder = null;
		tdde.modelDisplacement = null;
		tdde.modelFuelType = null;
		tdde.modelMakeId = 1;
		tdde.modelYear = 2019;
		tdde.plateNo = 'VDH8089';
		tdde.registrationDate = null;
		tdde.registrationNo = 'VDH8089';
		tdde.sellingPrice = null;
		tdde.shortChassis = 'LG63332';
		tdde.stockStatusId = 39;
		tdde.stockStatusCode = 'AVAILABLE';
		tdde.stockStatusName = 'AVAILABLE';
		tdde.stockStatusNumber = null;
		tdde.stockSubMakeId = null;
		tdde.stockSubMakeCode = null;
		tdde.stockSubMakeName = null;
		tdde.variantId = 497;
		tdde.variantCode = 'UJ38A7';
		tdde.variantName = 'BMW X4 xDrive30i M Sport (G02)';
		tdde.variantAssemblyCode = 'CBU';
		tdde.variantBodyType = 'Sport Activity Coupe';
		tdde.variantCylinder = 'In-Line 4';
		tdde.variantDisplacement = '1,998';
		tdde.extVariantUid = 'c286247f-e67d-e911-a995-000d3a828826';
		tdde.variantFuelType = 'Petrol';
		tdde.variantModelId = 169;
		tdde.variantMakeId = 1;
		tdde.variantSystem = 'Manual';
		tdde.tradePlateNo = 'VDH8089';
		tdde.actualDateStart = Datetime.valueOf('2020-08-05 16:09:29.4+08:00');
		tdde.actualDateEnd = null;
		tdde.mileageStart = 251;
		tdde.mileageEnd = null;
		tdde.mileageStartDocId = null;
		tdde.mileageEndDocId = null;
		tdde.odoStartDocId = null;
		tdde.odoEndDocId = null;
		tdde.guardMileageStart = null;
		tdde.guardMileageEnd = null;
		tdde.extTestDriveUid = null;
		tdde.insertDate = Datetime.valueOf('2020-08-05 16:09:29.4+08:00');
		tdde.insertUserId = 24;
		tdde.updateDate = Datetime.valueOf('2020-08-05 16:09:29.4+08:00');
		tdde.updateUserId = 67;
		tdrv.details.add(tdde);

		tdde = new SyncMoby05TestDrive.MobyTestDriveDetail();
		tdde.id = 20090;
		tdde.userId = 1376;
		tdde.contactId = 88301;
		tdde.testDriveId = 22760;
		tdde.companyId = 1;
		tdde.branchId = 3;
		tdde.makeId = 1;
		tdde.statusId = 15;
		tdde.statusCode = 'NEW';
		tdde.statusName = 'New';
		tdde.stockId = vehs[1].Name; // 'PM178AA020EP26325';
		tdde.categoryId = 15;
		tdde.categoryCode = 'DEMO';
		tdde.categoryName = 'Demo Car';
		tdde.colour = null;
		tdde.conditionId = 13;
		tdde.conditionCode = 'USED';
		tdde.conditionName = 'Used Car';
		tdde.modelId = 35;
		tdde.modelCode = 'F48';
		tdde.modelName = 'BMW X1 F48';
		tdde.modelAssemblyCode = 'CKD';
		tdde.modelBodyType = 'SAV';
		tdde.modelCylinder = 'In-Line 4';
		tdde.modelDisplacement = '1,998 cc';
		tdde.modelFuelType = 'Petrol';
		tdde.modelMakeId = 1;
		tdde.modelYear = 2020;
		tdde.plateNo = 'VEH8113';
		tdde.registrationDate = null;
		tdde.registrationNo = 'VEH8113';
		tdde.sellingPrice = null;
		tdde.shortChassis = 'EP26325';
		tdde.stockStatusId = 39;
		tdde.stockStatusCode = 'AVAILABLE';
		tdde.stockStatusName = 'AVAILABLE';
		tdde.stockStatusNumber = null;
		tdde.stockSubMakeId = null;
		tdde.stockSubMakeCode = null;
		tdde.stockSubMakeName = null;
		tdde.variantId = 4198;
		tdde.variantCode = '78AAA7';
		tdde.variantName = 'BMW X1 sDrive20i M Sport 2020 (F48)';
		tdde.variantAssemblyCode = null;
		tdde.variantBodyType = null;
		tdde.variantCylinder = 'Inline/4';
		tdde.variantDisplacement = '1,998';
		tdde.extVariantUid = '9afe48a0-f9b9-e611-80de-005056ac629c';
		tdde.variantFuelType = null;
		tdde.variantModelId = 35;
		tdde.variantMakeId = 1;
		tdde.variantSystem = null;
		tdde.tradePlateNo = 'VEH8113';
		tdde.actualDateStart = Datetime.valueOf('2020-08-05 16:09:54.13+08:00');
		tdde.actualDateEnd = null;
		tdde.mileageStart = 221;
		tdde.mileageEnd = null;
		tdde.mileageStartDocId = null;
		tdde.mileageEndDocId = null;
		tdde.odoStartDocId = null;
		tdde.odoEndDocId = null;
		tdde.guardMileageStart = null;
		tdde.guardMileageEnd = null;
		tdde.extTestDriveUid = null;
		tdde.insertDate = Datetime.valueOf('2020-08-05 16:09:54.13+08:00');
		tdde.insertUserId = 24;
		tdde.updateDate = Datetime.valueOf('2020-08-05 16:09:54.13+08:00');
		tdde.updateUserId = 67;
		tdrv.details.add(tdde);

		tdde = new SyncMoby05TestDrive.MobyTestDriveDetail();
		tdde.id = 20091;
		tdde.userId = 1376;
		tdde.contactId = 88301;
		tdde.testDriveId = 22760;
		tdde.companyId = 1;
		tdde.branchId = 3;
		tdde.makeId = 1;
		tdde.statusId = 15;
		tdde.statusCode = 'NEW';
		tdde.statusName = 'New';
		tdde.stockId = vehs[1].Name; // 'PM1UJ38020LG63332';
		tdde.categoryId = 15;
		tdde.categoryCode = 'DEMO';
		tdde.categoryName = 'Demo Car';
		tdde.colour = null;
		tdde.conditionId = 13;
		tdde.conditionCode = 'USED';
		tdde.conditionName = 'Used Car';
		tdde.modelId = 169;
		tdde.modelCode = 'G02';
		tdde.modelName = 'BMW X4 G02';
		tdde.modelAssemblyCode = 'CBU';
		tdde.modelBodyType = null;
		tdde.modelCylinder = null;
		tdde.modelDisplacement = null;
		tdde.modelFuelType = null;
		tdde.modelMakeId = 1;
		tdde.modelYear = 2019;
		tdde.plateNo = 'VDH8089';
		tdde.registrationDate = null;
		tdde.registrationNo = 'VDH8089';
		tdde.sellingPrice = null;
		tdde.shortChassis = 'LG63332';
		tdde.stockStatusId = 39;
		tdde.stockStatusCode = 'AVAILABLE';
		tdde.stockStatusName = 'AVAILABLE';
		tdde.stockStatusNumber = null;
		tdde.stockSubMakeId = null;
		tdde.stockSubMakeCode = null;
		tdde.stockSubMakeName = null;
		tdde.variantId = 497;
		tdde.variantCode = 'UJ38A7';
		tdde.variantName = 'BMW X4 xDrive30i M Sport (G02)';
		tdde.variantAssemblyCode = 'CBU';
		tdde.variantBodyType = 'Sport Activity Coupe';
		tdde.variantCylinder = 'In-Line 4';
		tdde.variantDisplacement = '1,998';
		tdde.extVariantUid = 'c286247f-e67d-e911-a995-000d3a828826';
		tdde.variantFuelType = 'Petrol';
		tdde.variantModelId = 169;
		tdde.variantMakeId = 1;
		tdde.variantSystem = 'Manual';
		tdde.tradePlateNo = 'VDH8089';
		tdde.actualDateStart = Datetime.valueOf('2020-08-05 16:10:52.323+08:00');
		tdde.actualDateEnd = null;
		tdde.mileageStart = 251;
		tdde.mileageEnd = null;
		tdde.mileageStartDocId = null;
		tdde.mileageEndDocId = null;
		tdde.odoStartDocId = null;
		tdde.odoEndDocId = null;
		tdde.guardMileageStart = null;
		tdde.guardMileageEnd = null;
		tdde.extTestDriveUid = null;
		tdde.insertDate = Datetime.valueOf('2020-08-05 16:10:52.323+08:00');
		tdde.insertUserId = 24;
		tdde.updateDate = Datetime.valueOf('2020-08-05 16:10:52.323+08:00');
		tdde.updateUserId = 67;
		tdrv.details.add(tdde);

		tdde = new SyncMoby05TestDrive.MobyTestDriveDetail();
		tdde.id = 20092;
		tdde.userId = 1376;
		tdde.contactId = 88301;
		tdde.testDriveId = 22760;
		tdde.companyId = 1;
		tdde.branchId = 3;
		tdde.makeId = 1;
		tdde.statusId = 15;
		tdde.statusCode = 'NEW';
		tdde.statusName = 'New';
		tdde.stockId = vehs[2].Name; // 'PM1UJ38020LG63332';
		tdde.categoryId = 15;
		tdde.categoryCode = 'DEMO';
		tdde.categoryName = 'Demo Car';
		tdde.colour = null;
		tdde.conditionId = 13;
		tdde.conditionCode = 'USED';
		tdde.conditionName = 'Used Car';
		tdde.modelId = 169;
		tdde.modelCode = 'G02';
		tdde.modelName = 'BMW X4 G02';
		tdde.modelAssemblyCode = 'CBU';
		tdde.modelBodyType = null;
		tdde.modelCylinder = null;
		tdde.modelDisplacement = null;
		tdde.modelFuelType = null;
		tdde.modelMakeId = 1;
		tdde.modelYear = 2019;
		tdde.plateNo = 'VDH8089';
		tdde.registrationDate = null;
		tdde.registrationNo = 'VDH8089';
		tdde.sellingPrice = null;
		tdde.shortChassis = 'LG63332';
		tdde.stockStatusId = 39;
		tdde.stockStatusCode = 'AVAILABLE';
		tdde.stockStatusName = 'AVAILABLE';
		tdde.stockStatusNumber = null;
		tdde.stockSubMakeId = null;
		tdde.stockSubMakeCode = null;
		tdde.stockSubMakeName = null;
		tdde.variantId = 497;
		tdde.variantCode = 'UJ38A7';
		tdde.variantName = 'BMW X4 xDrive30i M Sport (G02)';
		tdde.variantAssemblyCode = 'CBU';
		tdde.variantBodyType = 'Sport Activity Coupe';
		tdde.variantCylinder = 'In-Line 4';
		tdde.variantDisplacement = '1,998';
		tdde.extVariantUid = 'c286247f-e67d-e911-a995-000d3a828826';
		tdde.variantFuelType = 'Petrol';
		tdde.variantModelId = 169;
		tdde.variantMakeId = 1;
		tdde.variantSystem = 'Manual';
		tdde.tradePlateNo = 'VDH8089';
		tdde.actualDateStart = Datetime.valueOf('2020-08-05 16:13:29.52+08:00');
		tdde.actualDateEnd = null;
		tdde.mileageStart = 251;
		tdde.mileageEnd = null;
		tdde.mileageStartDocId = null;
		tdde.mileageEndDocId = null;
		tdde.odoStartDocId = null;
		tdde.odoEndDocId = null;
		tdde.guardMileageStart = null;
		tdde.guardMileageEnd = null;
		tdde.extTestDriveUid = null;
		tdde.insertDate = Datetime.valueOf('2020-08-05 16:13:29.52+08:00');
		tdde.insertUserId = 24;
		tdde.updateDate = Datetime.valueOf('2020-08-05 16:13:29.52+08:00');
		tdde.updateUserId = 67;
		tdrv.details.add(tdde);

		tdde = new SyncMoby05TestDrive.MobyTestDriveDetail();
		tdde.id = 20093;
		tdde.userId = 1376;
		tdde.contactId = 88301;
		tdde.testDriveId = 22760;
		tdde.companyId = 1;
		tdde.branchId = 3;
		tdde.makeId = 1;
		tdde.statusId = 15;
		tdde.statusCode = 'NEW';
		tdde.statusName = 'New';
		tdde.stockId = vehs[0].Name; // 'PM1UJ38020LG63332';
		tdde.categoryId = 15;
		tdde.categoryCode = 'DEMO';
		tdde.categoryName = 'Demo Car';
		tdde.colour = null;
		tdde.conditionId = 13;
		tdde.conditionCode = 'USED';
		tdde.conditionName = 'Used Car';
		tdde.modelId = 169;
		tdde.modelCode = 'G02';
		tdde.modelName = 'BMW X4 G02';
		tdde.modelAssemblyCode = 'CBU';
		tdde.modelBodyType = null;
		tdde.modelCylinder = null;
		tdde.modelDisplacement = null;
		tdde.modelFuelType = null;
		tdde.modelMakeId = 1;
		tdde.modelYear = 2019;
		tdde.plateNo = 'VDH8089';
		tdde.registrationDate = null;
		tdde.registrationNo = 'VDH8089';
		tdde.sellingPrice = null;
		tdde.shortChassis = 'LG63332';
		tdde.stockStatusId = 39;
		tdde.stockStatusCode = 'AVAILABLE';
		tdde.stockStatusName = 'AVAILABLE';
		tdde.stockStatusNumber = null;
		tdde.stockSubMakeId = null;
		tdde.stockSubMakeCode = null;
		tdde.stockSubMakeName = null;
		tdde.variantId = 497;
		tdde.variantCode = 'UJ38A7';
		tdde.variantName = 'BMW X4 xDrive30i M Sport (G02)';
		tdde.variantAssemblyCode = 'CBU';
		tdde.variantBodyType = 'Sport Activity Coupe';
		tdde.variantCylinder = 'In-Line 4';
		tdde.variantDisplacement = '1,998';
		tdde.extVariantUid = 'c286247f-e67d-e911-a995-000d3a828826';
		tdde.variantFuelType = 'Petrol';
		tdde.variantModelId = 169;
		tdde.variantMakeId = 1;
		tdde.variantSystem = 'Manual';
		tdde.tradePlateNo = 'VDH8089';
		tdde.actualDateStart = Datetime.valueOf('2020-08-05 16:15:28.19+08:00');
		tdde.actualDateEnd = null;
		tdde.mileageStart = 251;
		tdde.mileageEnd = null;
		tdde.mileageStartDocId = null;
		tdde.mileageEndDocId = null;
		tdde.odoStartDocId = null;
		tdde.odoEndDocId = null;
		tdde.guardMileageStart = null;
		tdde.guardMileageEnd = null;
		tdde.extTestDriveUid = null;
		tdde.insertDate = Datetime.valueOf('2020-08-05 16:15:28.19+08:00');
		tdde.insertUserId = 24;
		tdde.updateDate = Datetime.valueOf('2020-08-05 16:15:28.19+08:00');
		tdde.updateUserId = 67;
		tdrv.details.add(tdde);

		tdde = new SyncMoby05TestDrive.MobyTestDriveDetail();
		tdde.id = 20094;
		tdde.userId = 1376;
		tdde.contactId = 88301;
		tdde.testDriveId = 22760;
		tdde.companyId = 1;
		tdde.branchId = 3;
		tdde.makeId = 1;
		tdde.statusId = 15;
		tdde.statusCode = 'NEW';
		tdde.statusName = 'New';
		tdde.stockId = vehs[1].Name; // 'PM1UJ38020LG63332';
		tdde.categoryId = 15;
		tdde.categoryCode = 'DEMO';
		tdde.categoryName = 'Demo Car';
		tdde.colour = null;
		tdde.conditionId = 13;
		tdde.conditionCode = 'USED';
		tdde.conditionName = 'Used Car';
		tdde.modelId = 169;
		tdde.modelCode = 'G02';
		tdde.modelName = 'BMW X4 G02';
		tdde.modelAssemblyCode = 'CBU';
		tdde.modelBodyType = null;
		tdde.modelCylinder = null;
		tdde.modelDisplacement = null;
		tdde.modelFuelType = null;
		tdde.modelMakeId = 1;
		tdde.modelYear = 2019;
		tdde.plateNo = 'VDH8089';
		tdde.registrationDate = null;
		tdde.registrationNo = 'VDH8089';
		tdde.sellingPrice = null;
		tdde.shortChassis = 'LG63332';
		tdde.stockStatusId = 39;
		tdde.stockStatusCode = 'AVAILABLE';
		tdde.stockStatusName = 'AVAILABLE';
		tdde.stockStatusNumber = null;
		tdde.stockSubMakeId = null;
		tdde.stockSubMakeCode = null;
		tdde.stockSubMakeName = null;
		tdde.variantId = 497;
		tdde.variantCode = 'UJ38A7';
		tdde.variantName = 'BMW X4 xDrive30i M Sport (G02)';
		tdde.variantAssemblyCode = 'CBU';
		tdde.variantBodyType = 'Sport Activity Coupe';
		tdde.variantCylinder = 'In-Line 4';
		tdde.variantDisplacement = '1,998';
		tdde.extVariantUid = 'c286247f-e67d-e911-a995-000d3a828826';
		tdde.variantFuelType = 'Petrol';
		tdde.variantModelId = 169;
		tdde.variantMakeId = 1;
		tdde.variantSystem = 'Manual';
		tdde.tradePlateNo = 'VDH8089';
		tdde.actualDateStart = Datetime.valueOf('2020-08-05 16:16:13.317+08:00');
		tdde.actualDateEnd = null;
		tdde.mileageStart = 251;
		tdde.mileageEnd = null;
		tdde.mileageStartDocId = null;
		tdde.mileageEndDocId = null;
		tdde.odoStartDocId = null;
		tdde.odoEndDocId = null;
		tdde.guardMileageStart = null;
		tdde.guardMileageEnd = null;
		tdde.extTestDriveUid = null;
		tdde.insertDate = Datetime.valueOf('2020-08-05 16:16:13.317+08:00');
		tdde.insertUserId = 24;
		tdde.updateDate = Datetime.valueOf('2020-08-05 16:16:13.317+08:00');
		tdde.updateUserId = 67;
		tdrv.details.add(tdde);

		tdde = new SyncMoby05TestDrive.MobyTestDriveDetail();
		tdde.id = 20095;
		tdde.userId = 1376;
		tdde.contactId = 88301;
		tdde.testDriveId = 22760;
		tdde.companyId = 1;
		tdde.branchId = 3;
		tdde.makeId = 1;
		tdde.statusId = 15;
		tdde.statusCode = 'NEW';
		tdde.statusName = 'New';
		tdde.stockId = vehs[2].Name; // 'PM1UJ38020LG63332';
		tdde.categoryId = 15;
		tdde.categoryCode = 'DEMO';
		tdde.categoryName = 'Demo Car';
		tdde.colour = null;
		tdde.conditionId = 13;
		tdde.conditionCode = 'USED';
		tdde.conditionName = 'Used Car';
		tdde.modelId = 169;
		tdde.modelCode = 'G02';
		tdde.modelName = 'BMW X4 G02';
		tdde.modelAssemblyCode = 'CBU';
		tdde.modelBodyType = null;
		tdde.modelCylinder = null;
		tdde.modelDisplacement = null;
		tdde.modelFuelType = null;
		tdde.modelMakeId = 1;
		tdde.modelYear = 2019;
		tdde.plateNo = 'VDH8089';
		tdde.registrationDate = null;
		tdde.registrationNo = 'VDH8089';
		tdde.sellingPrice = null;
		tdde.shortChassis = 'LG63332';
		tdde.stockStatusId = 39;
		tdde.stockStatusCode = 'AVAILABLE';
		tdde.stockStatusName = 'AVAILABLE';
		tdde.stockStatusNumber = null;
		tdde.stockSubMakeId = null;
		tdde.stockSubMakeCode = null;
		tdde.stockSubMakeName = null;
		tdde.variantId = 497;
		tdde.variantCode = 'UJ38A7';
		tdde.variantName = 'BMW X4 xDrive30i M Sport (G02)';
		tdde.variantAssemblyCode = 'CBU';
		tdde.variantBodyType = 'Sport Activity Coupe';
		tdde.variantCylinder = 'In-Line 4';
		tdde.variantDisplacement = '1,998';
		tdde.extVariantUid = 'c286247f-e67d-e911-a995-000d3a828826';
		tdde.variantFuelType = 'Petrol';
		tdde.variantModelId = 169;
		tdde.variantMakeId = 1;
		tdde.variantSystem = 'Manual';
		tdde.tradePlateNo = 'VDH8089';
		tdde.actualDateStart = Datetime.valueOf('2020-08-05 16:16:17.497+08:00');
		tdde.actualDateEnd = null;
		tdde.mileageStart = 251;
		tdde.mileageEnd = null;
		tdde.mileageStartDocId = null;
		tdde.mileageEndDocId = null;
		tdde.odoStartDocId = null;
		tdde.odoEndDocId = null;
		tdde.guardMileageStart = null;
		tdde.guardMileageEnd = null;
		tdde.extTestDriveUid = null;
		tdde.insertDate = Datetime.valueOf('2020-08-05 16:16:17.497+08:00');
		tdde.insertUserId = 24;
		tdde.updateDate = Datetime.valueOf('2020-08-05 16:16:17.497+08:00');
		tdde.updateUserId = 67;
		tdrv.details.add(tdde);

		tdde = new SyncMoby05TestDrive.MobyTestDriveDetail();
		tdde.id = 20096;
		tdde.userId = 1376;
		tdde.contactId = 88301;
		tdde.testDriveId = 22760;
		tdde.companyId = 1;
		tdde.branchId = 3;
		tdde.makeId = 1;
		tdde.statusId = 15;
		tdde.statusCode = 'NEW';
		tdde.statusName = 'New';
		tdde.stockId = vehs[0].Name; // 'PM178AA020EP26325';
		tdde.categoryId = 15;
		tdde.categoryCode = 'DEMO';
		tdde.categoryName = 'Demo Car';
		tdde.colour = null;
		tdde.conditionId = 13;
		tdde.conditionCode = 'USED';
		tdde.conditionName = 'Used Car';
		tdde.modelId = 35;
		tdde.modelCode = 'F48';
		tdde.modelName = 'BMW X1 F48';
		tdde.modelAssemblyCode = 'CKD';
		tdde.modelBodyType = 'SAV';
		tdde.modelCylinder = 'In-Line 4';
		tdde.modelDisplacement = '1,998 cc';
		tdde.modelFuelType = 'Petrol';
		tdde.modelMakeId = 1;
		tdde.modelYear = 2020;
		tdde.plateNo = 'VEH8113';
		tdde.registrationDate = null;
		tdde.registrationNo = 'VEH8113';
		tdde.sellingPrice = null;
		tdde.shortChassis = 'EP26325';
		tdde.stockStatusId = 39;
		tdde.stockStatusCode = 'AVAILABLE';
		tdde.stockStatusName = 'AVAILABLE';
		tdde.stockStatusNumber = null;
		tdde.stockSubMakeId = null;
		tdde.stockSubMakeCode = null;
		tdde.stockSubMakeName = null;
		tdde.variantId = 4198;
		tdde.variantCode = '78AAA7';
		tdde.variantName = 'BMW X1 sDrive20i M Sport 2020 (F48)';
		tdde.variantAssemblyCode = null;
		tdde.variantBodyType = null;
		tdde.variantCylinder = 'Inline/4';
		tdde.variantDisplacement = '1,998';
		tdde.extVariantUid = '9afe48a0-f9b9-e611-80de-005056ac629c';
		tdde.variantFuelType = null;
		tdde.variantModelId = 35;
		tdde.variantMakeId = 1;
		tdde.variantSystem = null;
		tdde.tradePlateNo = 'VEH8113';
		tdde.actualDateStart = Datetime.valueOf('2020-08-05 16:18:28.977+08:00');
		tdde.actualDateEnd = null;
		tdde.mileageStart = 231;
		tdde.mileageEnd = 238;
		tdde.mileageStartDocId = null;
		tdde.mileageEndDocId = null;
		tdde.odoStartDocId = null;
		tdde.odoEndDocId = null;
		tdde.guardMileageStart = null;
		tdde.guardMileageEnd = null;
		tdde.extTestDriveUid = null;
		tdde.insertDate = Datetime.valueOf('2020-08-05 16:18:28.977+08:00');
		tdde.insertUserId = 24;
		tdde.updateDate = Datetime.valueOf('2020-08-05 16:18:28.977+08:00');
		tdde.updateUserId = 67;
		tdrv.details.add(tdde);
		response.testDrives.add(tdrv);

		response.lastKey = 22760;

		return response;
	}

	@isTest
	public static void testPull() {
		SyncMoby05TestDrive.MobyTestDriveRes res = createObj();

		TestWSMock.SQL_QUEUE_API mock = new TestWSMock.SQL_QUEUE_API(200, JSON.serialize(res));
		Test.setMock(HttpCalloutMock.class, mock);
		Test.startTest();
		SyncMoby05TestDrive job = new SyncMoby05TestDrive();
		job.followOnToNext = true;
		System.enqueueJob(job);
		job.execute(null); // kick out of queue
		Test.stopTest();

		System.debug(JSON.serialize([SELECT Id, Name FROM Test_Drive__c]));
		System.assertEquals(10,	[SELECT Id FROM Test_Drive__c].size());
	}

	@isTest
	static void testPullUpdateByMobyId() {
		SyncMoby05TestDrive.MobyTestDriveRes res = createObj();

		SyncMoby05TestDrive job = new SyncMoby05TestDrive();
		job.upsertTestDrive(res);

		/** Coverage:
		 * SyncMoby05TestDrive: 290
		 * 	Remove MobyBranchNumber__c */
		Showroom__c[] shows = [SELECT Id, Name, MobyBranchNumber__c, MobyBranchCode__c FROM Showroom__c];
		shows[1].MobyBranchNumber__c = null;
		update shows;

		TestWSMock.SQL_QUEUE_API mock = new TestWSMock.SQL_QUEUE_API(200, JSON.serialize(res));
		Test.setMock(HttpCalloutMock.class, mock);
		Test.startTest();
		SyncMoby05TestDrive kob = new SyncMoby05TestDrive();
		kob.followOnToNext = true;
		kob.execute(null);
		Test.stopTest();
		System.assertEquals(10, [SELECT Id FROM Test_Drive__c].size());
	}

	@isTest static void testPullNoRow() {
		SyncMoby05TestDrive.MobyTestDriveRes res = new SyncMoby05TestDrive.MobyTestDriveRes();
		TestWSMock.SQL_QUEUE_API mock = new TestWSMock.SQL_QUEUE_API(200, JSON.serialize(res));
		Test.setMock(HttpCalloutMock.class, mock);
		Test.startTest();
		SyncMoby05TestDrive job = new SyncMoby05TestDrive();
		job.dateFrom = null;
		job.dateTo = null;
		job.followOnToNext = true;
		job.execute(null);
		Test.stopTest();
	}

	@isTest static void testPullStatusNotOK() {
		TestWSMock.SQL_QUEUE_API mock = new TestWSMock.SQL_QUEUE_API(400, 'Error retrieving data');
		Test.setMock(HttpCalloutMock.class, mock);
        Test.startTest();
        SyncMoby05TestDrive job = new SyncMoby05TestDrive();
        job.followOnToNext = true;
        System.enqueueJob(job);
        Test.stopTest();
	}

	@isTest static void testPull_E() {
		Test.setMock(HttpCalloutMock.class, new TestWSMock.HttpThrowE());
		Test.startTest();
		SyncMoby05TestDrive job = new SyncMoby05TestDrive();
		job.followOnToNext = true;
		System.enqueueJob(job);
		Test.stopTest();

	}
	@isTest static void testPull_ECallout() {
		Test.setMock(HttpCalloutMock.class, new TestWSMock.HttpThrowECallout());
		Test.startTest();
		SyncMoby05TestDrive job = new SyncMoby05TestDrive();
		job.followOnToNext = true;
		job.rowCount = job.minRowCount + 1;
		System.enqueueJob(job);
		Test.stopTest();
	}
	@isTest static void testPull_ECallout2() {
		Test.setMock(HttpCalloutMock.class, new TestWSMock.HttpThrowECallout());
		Test.startTest();
		SyncMoby05TestDrive job = new SyncMoby05TestDrive();
		job.followOnToNext = true;
		job.rowCount = job.minRowCount - 1;
		System.enqueueJob(job);
		Test.stopTest();
	}

}